# Vimagram - Vimalinx Server Android 客户端

中文 | [English](README.en.md)

Vimagram 是 Vimalinx Server 的官方 Android 客户端，提供用户注册、登录、Token 管理、消息收发等功能。

---

## ✨ 功能特性

- **用户管理**：注册新账号、使用账号密码登录
- **Token 管理**：生成和管理主机 Token，用于 Gateway 插件认证
- **实时聊天**：支持实时收发私聊消息
- **直接连接**：直接连接 Vimalinx Server，无需经过 Gateway
- **多语言支持**：支持系统语言、中文、英文切换
- **账号恢复**：账号页展示已连接主机 Token，方便配置恢复

---

## 📱 安装指南

### 方式一：下载 APK 安装（推荐）

1. 从 GitHub Releases 获取最新 APK 安装包：<https://github.com/vimalinx/vimalinx-suite-core/releases>
2. 在 Android 设备上启用 **未知来源应用安装**：
   - Android 8.0+：设置 → 安全 → 允许来自未知来源的应用
3. 下载并安装 APK 文件
4. 设备弹出安装权限时，点击 **允许** 或 **继续安装**

### 方式二：从源码编译安装（开发者）

#### 前置要求

- **Android Studio**：最新版本
- **Android SDK**：Android 5.0 (API 21) 或更高版本
- **Gradle**：项目包含 Gradle Wrapper，无需单独安装

#### 使用 Android Studio

1. 打开 Android Studio
2. 选择 **Open an Existing Project**
3. 选择项目根目录下的 `app` 目录
4. 等待 Gradle 同步完成
5. 连接 Android 设备或启动模拟器
6. 点击运行按钮（绿色三角形）或按 `Shift + F10`

#### 使用命令行

进入 `app` 目录，执行以下命令：

```bash
cd app

# 构建 Debug 版本
./gradlew :app:assembleDebug

# 安装 Debug 版本到设备
./gradlew :app:installDebug

# 运行单元测试
./gradlew :app:testDebugUnitTest

# 构建 Release 版本
./gradlew :app:assembleRelease
```

**Android SDK 路径配置：**

如果未设置 `ANDROID_SDK_ROOT` 或 `ANDROID_HOME` 环境变量，Gradle 会默认使用以下路径：

- **macOS**：`~/Library/Android/sdk`
- **Linux**：`~/Android/Sdk`
- **Windows**：`%LOCALAPPDATA%\Android\Sdk`

如果 SDK 安装在其他位置，可以设置环境变量：

```bash
# macOS / Linux
export ANDROID_SDK_ROOT=/path/to/your/android/sdk
export ANDROID_HOME=/path/to/your/android/sdk

# Windows (PowerShell)
$env:ANDROID_SDK_ROOT="C:\path\to\your\android\sdk"
$env:ANDROID_HOME="C:\path\to\your\android\sdk"
```

---

## 🚀 快速开始

### 1. 首次启动

1. 打开 Vimagram App
2. 应用会请求以下权限（请允许）：
   - **网络权限**：用于连接服务器
   - **存储权限**：用于保存聊天记录和缓存
3. 选择界面语言（系统默认 / 中文 / English）

### 2. 配置服务器

首次使用需要配置 Vimalinx Server 地址：

1. 在登录页面，点击 **服务器地址** 输入框
2. 输入服务器地址，格式：
   - HTTP：`http://server-host:port`（例如：`http://123.60.21.129:8788`）
   - HTTPS：`https://server-host:port`（推荐用于生产环境）
3. 点击 **测试连接** 按钮验证服务器是否可访问
4. 连接成功后，服务器地址会自动保存

**注意**：
- 请确保服务器地址正确，包含端口号
- 如果使用 HTTPS，请确保服务器证书有效
- 服务器地址可以随时在设置中修改

### 3. 注册账号

#### 如果服务器允许开放注册：

1. 点击 **注册** 按钮
2. 填写注册信息：
   - **用户名**：登录使用的用户名（必填）
   - **密码**：登录密码（必填，建议使用强密码）
   - **显示名称**：在聊天中显示的昵称（选填）
3. 如果服务器启用了邀请码模式，输入有效的邀请码
4. 点击 **注册** 按钮

#### 如果服务器关闭了开放注册：

1. 需要从服务器管理员处获取账号
2. 使用 **登录** 功能登录

### 4. 登录

1. 输入用户名和密码
2. 点击 **登录** 按钮
3. 登录成功后，进入聊天界面

### 5. 生成主机 Token

主机 Token 用于 Gateway 插件认证，获取步骤：

1. 登录成功后，进入 **Account** 页面（点击右下角头像或菜单）
2. 在 **主机 Token** 部分，点击 **生成 Token** 按钮
3. **重要**：Token 仅显示一次，请立即复制并妥善保存
4. 复制 Token 到剪贴板，然后可以在 Gateway 配置中使用

**注意事项**：
- Token 是敏感信息，不要泄露给他人
- 如果 Token 泄露或需要更换，可以删除旧 Token 后重新生成
- 一个账号可以生成多个 Token，每个 Token 都独立有效
- Token 不会过期，除非在服务器上手动撤销

### 6. 使用 Token 配置 Gateway

获取 Token 后，按照以下步骤配置 Gateway 插件：

1. 在项目根目录运行：
   ```bash
   ./install.sh
   ```
2. 输入服务器地址（直接回车使用默认服务器）
3. 粘贴从 Vimagram 复制的 Token
4. 安装脚本会自动配置并启动插件

详细说明请参考 [主 README](../README.md) 和 [Plugin 文档](../plugin/README.md)。

---

## 💬 聊天功能

### 发送消息

1. 在聊天列表中选择要对话的用户
2. 在底部输入框输入消息内容
3. 点击 **发送** 按钮（或按回车键）

### 接收消息

- 消息会实时显示在聊天界面
- 会显示发送者名称和消息内容
- 支持消息时间戳显示

### 消息历史

- 聊天记录会保存在本地
- 可以在设置中清空聊天记录

---

## ⚙️ 设置和配置

### 语言设置

1. 进入 **设置** 页面
2. 点击 **语言**
3. 选择：系统默认 / 中文 / English

### 修改服务器地址

1. 进入 **设置** 页面
2. 点击 **服务器地址**
3. 输入新的服务器地址
4. 点击 **保存**
5. 应用会自动重新连接到新服务器

### 管理主机 Token

1. 进入 **Account** 页面
2. 在 **主机 Token** 部分：
   - 查看已生成的 Token 列表
   - 删除不需要的 Token
   - 生成新的 Token

### 清空聊天记录

1. 进入 **设置** 页面
2. 点击 **清空聊天记录**
3. 确认操作

---

## 🐛 故障排查

### 问题 1：无法连接到服务器

**症状**：点击 **测试连接** 或登录时提示连接失败

**解决方法：**

1. **检查网络连接**
   - 确保设备已连接到互联网
   - 尝试切换网络（Wi-Fi / 移动数据）

2. **检查服务器地址**
   - 确认服务器地址是否正确
   - 检查是否包含端口号（例如：`:8788`）
   - 使用浏览器访问服务器地址测试是否能打开

3. **检查服务器状态**
   - 确认 Vimalinx Server 正在运行
   - 联系服务器管理员确认服务器是否正常

4. **检查防火墙**
   - 确保设备防火墙允许应用访问网络
   - 检查服务器防火墙是否允许外部连接

### 问题 2：注册失败

**症状**：点击 **注册** 后提示注册失败

**可能原因和解决方法：**

1. **用户名已存在**
   - 更换用户名
   - 如果忘记密码，请联系服务器管理员

2. **邀请码无效**
   - 检查邀请码是否正确
   - 联系管理员获取有效的邀请码

3. **服务器关闭了注册**
   - 联系管理员创建账号，然后使用 **登录** 功能

4. **网络问题**
   - 检查网络连接
   - 稍后再试

### 问题 3：登录失败

**症状**：输入正确的用户名和密码后提示登录失败

**解决方法：**

1. **检查用户名和密码**
   - 确认用户名和密码是否正确（区分大小写）
   - 检查输入框中是否有多余空格

2. **检查服务器地址**
   - 确认连接的是正确的服务器

3. **账号被禁用**
   - 联系服务器管理员确认账号状态

### 问题 4：消息无法发送

**症状**：点击 **发送** 后消息没有发送出去

**解决方法：**

1. **检查网络连接**
   - 确保网络连接正常

2. **检查服务器连接**
   - 在设置中测试服务器连接
   - 如果连接失败，检查服务器状态

3. **检查消息内容**
   - 确认消息内容不为空
   - 检查是否有特殊字符导致发送失败

### 问题 5：Token 无法生成

**症状**：点击 **生成 Token** 后没有反应或提示错误

**解决方法：**

1. **检查登录状态**
   - 确认已成功登录
   - 如果登录已过期，重新登录

2. **检查服务器连接**
   - 确保服务器连接正常

3. **联系管理员**
   - 如果问题持续存在，可能是服务器配置问题

---

## 📚 相关文档

- **主 README**：`../README.md`
- **Server 文档**：`../server/README.md`
- **Plugin 文档**：`../plugin/README.md`

---

## 🔐 安全建议

1. **密码安全**
   - 使用强密码（包含字母、数字、特殊字符）
   - 不要与他人共享密码
   - 定期更换密码

2. **Token 安全**
   - Token 仅显示一次，请妥善保存
   - 不要将 Token 泄露给他人
   - 如果 Token 泄露，立即删除并生成新 Token

3. **网络安全**
   - 在公共网络环境中谨慎使用
   - 建议使用 HTTPS 连接服务器
   - 及时更新应用到最新版本

---

## 📄 许可证

本项目采用 MIT 许可证。

---

## 📞 支持和反馈

如果遇到问题或有建议，请：

1. 查看本文档的 **故障排查** 部分
2. 在 GitHub Issues 提交问题报告
3. 联系项目维护者
